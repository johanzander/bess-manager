<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decision Intelligence</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* Base styling matching SavingsView components */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 24px;
            background-color: #f9fafb;
            color: #111827;
            line-height: 1.5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            margin-bottom: 24px;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin: 0 0 8px 0;
            color: #111827;
        }
        
        .header p {
            color: #6b7280;
            margin: 0;
            font-size: 14px;
        }
        
        /* Table container matching SavingsOverview */
        .table-container {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .table-header h2 {
            font-size: 20px;
            font-weight: 600;
            margin: 0 0 8px 0;
            color: #111827;
        }
        
        .table-header p {
            color: #6b7280;
            margin: 0;
            font-size: 14px;
        }
        
        /* Toggle buttons matching SavingsPage */
        .toggle-buttons {
            display: flex;
            gap: 8px;
        }
        
        .toggle-btn {
            display: flex;
            align-items: center;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        
        .toggle-btn.active {
            background: white;
            color: #111827;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .toggle-btn:not(.active) {
            color: #6b7280;
            background: transparent;
        }
        
        .toggle-btn:not(.active):hover {
            color: #111827;
        }
        
        /* Table styling exactly like SavingsOverview */
        .data-table {
            min-width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        .data-table thead {
            background: #f9fafb;
        }
        
        .data-table th {
            padding: 8px 12px;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            color: #374151;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border: 1px solid #e5e7eb;
        }
        
        .data-table th:first-child {
            text-align: left;
        }
        
        .data-table td {
            padding: 8px 12px;
            white-space: nowrap;
            font-size: 14px;
            color: #111827;
            border: 1px solid #e5e7eb;
        }
        
        .data-table td:first-child {
            font-weight: 500;
        }
        
        /* Row styling matching SavingsOverview */
        .hour-row {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .hour-row:hover {
            background-color: #f9fafb;
        }
        
        .hour-row.actual {
            border-left: 4px solid #22c55e;
            background-color: #f9fafb;
        }
        
        .hour-row.predicted {
            border-left: 4px solid #e5e7eb;
            background-color: white;
        }
        
        .hour-row.current {
            border-left: 4px solid #a855f7;
            background-color: #faf5ff;
        }
        
        /* Badge styling */
        .badge {
            margin-left: 8px;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .badge-actual {
            background: #dcfce7;
            color: #166534;
        }
        
        .badge-predicted {
            background: #f3f4f6;
            color: #374151;
        }
        
        .badge-current {
            background: #f3e8ff;
            color: #7c3aed;
        }
        
        /* Value styling */
        .positive {
            color: #059669;
            font-weight: 500;
        }
        
        .negative {
            color: #dc2626;
            font-weight: 500;
        }
        
        .neutral {
            color: #6b7280;
            font-weight: 500;
        }
        
        .unit {
            font-size: 12px;
            color: #6b7280;
            font-weight: 400;
            display: block;
        }
        
        /* Expand icon */
        .expand-icon {
            width: 16px;
            height: 16px;
            color: #9ca3af;
            transition: transform 0.2s;
        }
        
        .hour-row.expanded .expand-icon {
            transform: rotate(90deg);
        }
        
        /* Details panel - now as table rows */
        .hour-details {
            /* No special styling needed for table rows */
        }
        
        .details-content {
            padding: 24px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 8px 16px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #6b7280;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .tab.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }
        
        .tab:hover:not(.active) {
            color: #374151;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Tab content styling */
        .view-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .view-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
        }
        
        .view-subtitle {
            color: #6b7280;
            font-size: 14px;
        }
        
        .content-box {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .chart-container {
            height: 250px;
            margin: 16px 0;
        }
        
        .detail-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        
        .detail-table th {
            background: #f9fafb;
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        
        .detail-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #f3f4f6;
            font-size: 14px;
        }
        
        .detail-table tr.highlight {
            background-color: #f0fdf4;
        }
        
        .detail-table tr.cost {
            background-color: #fef2f2;
        }
        
        .detail-table tr.total {
            border-top: 2px solid #374151;
            background-color: #f9fafb;
            font-weight: 600;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Toggle buttons in tabs */
        .tab-toggle {
            display: flex;
            gap: 4px;
        }
        
        .tab-toggle button {
            padding: 4px 8px;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tab-toggle button.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Decision Intelligence</h1>
            <p>Battery management optimization • Today, March 15, 2024</p>
        </div>

        <!-- Table Container -->
        <div class="table-container">
            <div class="table-header">
                <div>
                    <h2>Hourly Decision Analysis</h2>
                    <p>Click any hour to explore the decision reasoning</p>
                </div>
                <div class="toggle-buttons">
                    <button class="toggle-btn active" onclick="toggleTableView('simple')">Simple View</button>
                    <button class="toggle-btn" onclick="toggleTableView('full')">Full View</button>
                </div>
            </div>
            
            <!-- Simple View Table -->
            <table class="data-table" id="simple-table">
                <thead>
                    <tr>
                        <th>Hour</th>
                        <th>Battery Action</th>
                        <th>Immediate Value</th>
                        <th>Future Value</th>
                        <th>Total Reward</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Hour 00:00 -->
                    <tr class="hour-row actual" onclick="toggleHour(0)" data-hour="0">
                        <td>
                            <div>
                                00:00
                                <span class="badge badge-actual">Actual</span>
                            </div>
                        </td>
                        <td style="text-align: center;">
                            <div class="negative">-0.4 kWh</div>
                            <span class="unit">Discharge</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="negative">-1.53</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+3.53</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+2.00</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <svg class="expand-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </td>
                    </tr>
                    
                    <!-- Hour 0 Details -->
                    <tr class="hour-details" data-hour="0" style="display: none;">
                        <td colspan="6" style="padding: 0; border: none;">
                            <div class="details-content" style="background: #f8fafc; border-left: 4px solid #22c55e; padding: 24px;">
                                <div class="tabs">
                                    <div class="tab active" onclick="showTab(0, 'landscape')">Battery Action</div>
                                    <div class="tab" onclick="showTab(0, 'economic')">Immediate Value</div>
                                    <div class="tab" onclick="showTab(0, 'future')">Future Value</div>
                                </div>
                                
                                <div class="tab-content active" id="landscape-0">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">📊 Battery Action Analysis</div>
                                            <div class="view-subtitle">Why was -0.4 kWh chosen over all other possible actions?</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(0, 'landscape', 'chart')">Chart</button>
                                            <button onclick="toggleView(0, 'landscape', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="landscapeChartContainer-0">
                                        <canvas id="landscapeChart-0" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="landscapeTable-0">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Action (kWh)</th>
                                                    <th>Total Reward (SEK)</th>
                                                    <th>Difference</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="highlight">
                                                    <td><strong>-0.4 (Chosen)</strong></td>
                                                    <td class="positive">+2.00</td>
                                                    <td>Optimal</td>
                                                </tr>
                                                <tr>
                                                    <td>0.0 (Do Nothing)</td>
                                                    <td>+1.16</td>
                                                    <td class="negative">-0.84</td>
                                                </tr>
                                                <tr>
                                                    <td>-1.0</td>
                                                    <td>+0.30</td>
                                                    <td class="negative">-1.70</td>
                                                </tr>
                                                <tr>
                                                    <td>+1.0</td>
                                                    <td class="negative">-1.20</td>
                                                    <td class="negative">-3.20</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="tab-content" id="economic-0">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">💰 Immediate Value Analysis</div>
                                            <div class="view-subtitle">What economic components create the immediate value?</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(0, 'economic', 'chart')">Chart</button>
                                            <button onclick="toggleView(0, 'economic', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="economicChartContainer-0">
                                        <canvas id="economicChart-0" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="economicTable-0">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Component</th>
                                                    <th>Energy</th>
                                                    <th>Rate</th>
                                                    <th>Value</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="cost">
                                                    <td>Grid Purchase (Home)</td>
                                                    <td>0.8 kWh</td>
                                                    <td>1.91 SEK/kWh</td>
                                                    <td class="negative">-1.53 SEK</td>
                                                </tr>
                                                <tr class="highlight">
                                                    <td>Grid Avoidance Benefit</td>
                                                    <td>0.4 kWh</td>
                                                    <td>1.91 SEK/kWh</td>
                                                    <td class="positive">+0.76 SEK</td>
                                                </tr>
                                                <tr class="cost">
                                                    <td>Battery Cost Basis</td>
                                                    <td>0.4 kWh</td>
                                                    <td>0.40 SEK/kWh</td>
                                                    <td class="negative">-0.16 SEK</td>
                                                </tr>
                                                <tr class="cost">
                                                    <td>Battery Wear Cost</td>
                                                    <td>0.4 kWh</td>
                                                    <td>0.05 SEK/kWh</td>
                                                    <td class="negative">-0.02 SEK</td>
                                                </tr>
                                                <tr class="total">
                                                    <td><strong>Net Immediate Value</strong></td>
                                                    <td>-</td>
                                                    <td>-</td>
                                                    <td class="negative"><strong>-1.53 SEK</strong></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="tab-content" id="future-0">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">⏰ Future Value</div>
                                            <div class="view-subtitle">How this decision creates value in upcoming hours</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(0, 'future', 'chart')">Chart</button>
                                            <button onclick="toggleView(0, 'future', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="futureChartContainer-0">
                                        <canvas id="futureChart-0" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="futureTable-0">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Hour</th>
                                                    <th>Value Added (SEK)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr><td>01:00</td><td class="positive">+0.02</td></tr>
                                                <tr><td>02:00</td><td class="positive">+0.02</td></tr>
                                                <tr><td>03:00</td><td class="positive">+0.02</td></tr>
                                                <tr><td>08:00</td><td class="negative">-0.23</td></tr>
                                                <tr><td>17:00</td><td class="positive">+0.12</td></tr>
                                                <tr><td>18:00</td><td class="positive">+0.15</td></tr>
                                                <tr class="highlight"><td><strong>19:00</strong></td><td class="positive"><strong>+2.18</strong></td></tr>
                                                <tr><td>20:00</td><td class="positive">+0.08</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Hour 01:00 -->
                    <tr class="hour-row actual" onclick="toggleHour(1)" data-hour="1">
                        <td>
                            <div>
                                01:00
                                <span class="badge badge-actual">Actual</span>
                            </div>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+0.2 kWh</div>
                            <span class="unit">Charge</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+0.38</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+1.25</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+1.63</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <svg class="expand-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </td>
                    </tr>
                    
                    <!-- Hour 1 Details -->
                    <tr class="hour-details" data-hour="1" style="display: none;">
                        <td colspan="6" style="padding: 0; border: none;">
                            <div class="details-content" style="background: #f8fafc; border-left: 4px solid #22c55e; padding: 24px;">
                                <div class="tabs">
                                    <div class="tab active" onclick="showTab(1, 'landscape')">Battery Action</div>
                                    <div class="tab" onclick="showTab(1, 'economic')">Immediate Value</div>
                                    <div class="tab" onclick="showTab(1, 'future')">Future Value</div>
                                </div>
                                
                                <div class="tab-content active" id="landscape-1">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">📊 Battery Action Analysis</div>
                                            <div class="view-subtitle">Why was +0.2 kWh chosen over all other possible actions?</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(1, 'landscape', 'chart')">Chart</button>
                                            <button onclick="toggleView(1, 'landscape', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="landscapeChartContainer-1">
                                        <canvas id="landscapeChart-1" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="landscapeTable-1">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Action (kWh)</th>
                                                    <th>Total Reward (SEK)</th>
                                                    <th>Difference</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="highlight">
                                                    <td><strong>+0.2 (Chosen)</strong></td>
                                                    <td class="positive">+1.63</td>
                                                    <td>Optimal</td>
                                                </tr>
                                                <tr>
                                                    <td>0.0 (Do Nothing)</td>
                                                    <td>+0.80</td>
                                                    <td class="negative">-0.83</td>
                                                </tr>
                                                <tr>
                                                    <td>+0.5</td>
                                                    <td>+1.45</td>
                                                    <td class="negative">-0.18</td>
                                                </tr>
                                                <tr>
                                                    <td>-0.3</td>
                                                    <td>+0.80</td>
                                                    <td class="negative">-0.83</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="tab-content" id="economic-1">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">💰 Immediate Value Analysis</div>
                                            <div class="view-subtitle">What economic components create the immediate value?</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(1, 'economic', 'chart')">Chart</button>
                                            <button onclick="toggleView(1, 'economic', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="economicChartContainer-1">
                                        <canvas id="economicChart-1" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="economicTable-1">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Component</th>
                                                    <th>Energy</th>
                                                    <th>Rate</th>
                                                    <th>Value</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="highlight">
                                                    <td>Grid Purchase Avoidance</td>
                                                    <td>0.2 kWh</td>
                                                    <td>1.89 SEK/kWh</td>
                                                    <td class="positive">+0.38 SEK</td>
                                                </tr>
                                                <tr class="cost">
                                                    <td>Battery Cost Basis</td>
                                                    <td>0.2 kWh</td>
                                                    <td>0.40 SEK/kWh</td>
                                                    <td class="negative">-0.08 SEK</td>
                                                </tr>
                                                <tr class="cost">
                                                    <td>Battery Wear Cost</td>
                                                    <td>0.2 kWh</td>
                                                    <td>0.05 SEK/kWh</td>
                                                    <td class="negative">-0.01 SEK</td>
                                                </tr>
                                                <tr class="total">
                                                    <td><strong>Net Immediate Value</strong></td>
                                                    <td>-</td>
                                                    <td>-</td>
                                                    <td class="positive"><strong>+0.38 SEK</strong></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="tab-content" id="future-1">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">⏰ Future Value</div>
                                            <div class="view-subtitle">How this decision creates value in upcoming hours</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(1, 'future', 'chart')">Chart</button>
                                            <button onclick="toggleView(1, 'future', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="futureChartContainer-1">
                                        <canvas id="futureChart-1" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="futureTable-1">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Hour</th>
                                                    <th>Value Added (SEK)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr><td>02:00</td><td class="positive">+0.01</td></tr>
                                                <tr><td>03:00</td><td class="positive">+0.01</td></tr>
                                                <tr><td>08:00</td><td class="positive">+0.28</td></tr>
                                                <tr><td>09:00</td><td class="positive">+0.15</td></tr>
                                                <tr><td>18:00</td><td class="positive">+0.32</td></tr>
                                                <tr class="highlight"><td><strong>19:00</strong></td><td class="positive"><strong>+0.65</strong></td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Hour 02:00 -->
                    <tr class="hour-row predicted" onclick="toggleHour(2)" data-hour="2">
                        <td>
                            <div>
                                02:00
                                <span class="badge badge-predicted">Predicted</span>
                            </div>
                        </td>
                        <td style="text-align: center;">
                            <div class="neutral">0.0 kWh</div>
                            <span class="unit">Hold</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="neutral">0.00</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+2.15</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+2.15</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <svg class="expand-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </td>
                    </tr>
                    
                    <!-- Hour 2 Details -->
                    <tr class="hour-details" data-hour="2" style="display: none;">
                        <td colspan="6" style="padding: 0; border: none;">
                            <div class="details-content" style="background: #f8fafc; border-left: 4px solid #e5e7eb; padding: 24px;">
                                <div class="tabs">
                                    <div class="tab active" onclick="showTab(2, 'landscape')">Battery Action</div>
                                    <div class="tab" onclick="showTab(2, 'economic')">Immediate Value</div>
                                    <div class="tab" onclick="showTab(2, 'future')">Future Value</div>
                                </div>
                                
                                <div class="tab-content active" id="landscape-2">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">📊 Battery Action Analysis</div>
                                            <div class="view-subtitle">Why was holding (0.0 kWh) chosen over all other possible actions?</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(2, 'landscape', 'chart')">Chart</button>
                                            <button onclick="toggleView(2, 'landscape', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="landscapeChartContainer-2">
                                        <canvas id="landscapeChart-2" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="landscapeTable-2">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Action (kWh)</th>
                                                    <th>Total Reward (SEK)</th>
                                                    <th>Difference</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="highlight">
                                                    <td><strong>0.0 (Chosen)</strong></td>
                                                    <td class="positive">+2.15</td>
                                                    <td>Optimal</td>
                                                </tr>
                                                <tr>
                                                    <td>+0.3</td>
                                                    <td>+1.90</td>
                                                    <td class="negative">-0.25</td>
                                                </tr>
                                                <tr>
                                                    <td>-0.3</td>
                                                    <td>+1.85</td>
                                                    <td class="negative">-0.30</td>
                                                </tr>
                                                <tr>
                                                    <td>+1.0</td>
                                                    <td>+1.20</td>
                                                    <td class="negative">-0.95</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="tab-content" id="economic-2">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">💰 Immediate Value Analysis</div>
                                            <div class="view-subtitle">What economic components create the immediate value?</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(2, 'economic', 'chart')">Chart</button>
                                            <button onclick="toggleView(2, 'economic', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="economicChartContainer-2">
                                        <canvas id="economicChart-2" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="economicTable-2">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Component</th>
                                                    <th>Energy</th>
                                                    <th>Rate</th>
                                                    <th>Value</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Battery Action</td>
                                                    <td>0.0 kWh</td>
                                                    <td>-</td>
                                                    <td class="neutral">0.00 SEK</td>
                                                </tr>
                                                <tr>
                                                    <td>Opportunity Cost Avoided</td>
                                                    <td>-</td>
                                                    <td>-</td>
                                                    <td class="neutral">0.00 SEK</td>
                                                </tr>
                                                <tr class="total">
                                                    <td><strong>Net Immediate Value</strong></td>
                                                    <td>-</td>
                                                    <td>-</td>
                                                    <td class="neutral"><strong>0.00 SEK</strong></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="tab-content" id="future-2">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">⏰ Future Value</div>
                                            <div class="view-subtitle">How holding creates value in upcoming hours</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(2, 'future', 'chart')">Chart</button>
                                            <button onclick="toggleView(2, 'future', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="futureChartContainer-2">
                                        <canvas id="futureChart-2" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="futureTable-2">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Hour</th>
                                                    <th>Value Added (SEK)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr><td>03:00</td><td class="positive">+0.15</td></tr>
                                                <tr><td>04:00</td><td class="positive">+0.18</td></tr>
                                                <tr><td>05:00</td><td class="positive">+0.20</td></tr>
                                                <tr><td>06:00</td><td class="positive">+0.22</td></tr>
                                                <tr><td>07:00</td><td class="positive">+0.25</td></tr>
                                                <tr><td>08:00</td><td class="positive">+0.30</td></tr>
                                                <tr class="highlight"><td><strong>19:00</strong></td><td class="positive"><strong>+1.85</strong></td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <!-- Full View Table -->
            <table class="data-table hidden" id="full-table">
                <thead>
                    <tr>
                        <th>Hour</th>
                        <th>Home Load</th>
                        <th>Solar</th>
                        <th>Grid Price</th>
                        <th>Battery Action</th>
                        <th>Immediate Value</th>
                        <th>Future Value</th>
                        <th>Total Reward</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Hour 00:00 Full -->
                    <tr class="hour-row actual" onclick="toggleHour(0)" data-hour="0">
                        <td>
                            <div>
                                00:00
                                <span class="badge badge-actual">Actual</span>
                            </div>
                        </td>
                        <td style="text-align: center;">
                            <div>2.1</div>
                            <span class="unit">kWh</span>
                        </td>
                        <td style="text-align: center;">
                            <div style="color: #d97706;">0.0</div>
                            <span class="unit">kWh</span>
                        </td>
                        <td style="text-align: center;">
                            <div>1.91</div>
                            <span class="unit">SEK/kWh</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="negative">-0.4 kWh</div>
                            <span class="unit">Discharge</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="negative">-1.53</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+3.53</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+2.00</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <svg class="expand-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </td>
                    </tr>
                    
                    <!-- Hour 0 Details Full -->
                    <tr class="hour-details" data-hour="0" style="display: none;">
                        <td colspan="9" style="padding: 0; border: none;">
                            <div class="details-content" style="background: #f8fafc; border-left: 4px solid #22c55e; padding: 24px;">
                                <div class="tabs">
                                    <div class="tab active" onclick="showTab(0, 'landscape')">Battery Action</div>
                                    <div class="tab" onclick="showTab(0, 'economic')">Immediate Value</div>
                                    <div class="tab" onclick="showTab(0, 'future')">Future Value</div>
                                </div>
                                
                                <div class="tab-content active" id="landscape-0">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">📊 Battery Action Analysis</div>
                                            <div class="view-subtitle">Why was -0.4 kWh chosen over all other possible actions?</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(0, 'landscape', 'chart')">Chart</button>
                                            <button onclick="toggleView(0, 'landscape', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="landscapeChartContainer-0">
                                        <canvas id="landscapeChart-0" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="landscapeTable-0">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Action (kWh)</th>
                                                    <th>Total Reward (SEK)</th>
                                                    <th>Difference</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="highlight">
                                                    <td><strong>-0.4 (Chosen)</strong></td>
                                                    <td class="positive">+2.00</td>
                                                    <td>Optimal</td>
                                                </tr>
                                                <tr>
                                                    <td>0.0 (Do Nothing)</td>
                                                    <td>+1.16</td>
                                                    <td class="negative">-0.84</td>
                                                </tr>
                                                <tr>
                                                    <td>-1.0</td>
                                                    <td>+0.30</td>
                                                    <td class="negative">-1.70</td>
                                                </tr>
                                                <tr>
                                                    <td>+1.0</td>
                                                    <td class="negative">-1.20</td>
                                                    <td class="negative">-3.20</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="tab-content" id="economic-0">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">💰 Immediate Value Analysis</div>
                                            <div class="view-subtitle">What economic components create the immediate value?</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(0, 'economic', 'chart')">Chart</button>
                                            <button onclick="toggleView(0, 'economic', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="economicChartContainer-0">
                                        <canvas id="economicChart-0" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="economicTable-0">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Component</th>
                                                    <th>Energy</th>
                                                    <th>Rate</th>
                                                    <th>Value</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="cost">
                                                    <td>Grid Purchase (Home)</td>
                                                    <td>0.8 kWh</td>
                                                    <td>1.91 SEK/kWh</td>
                                                    <td class="negative">-1.53 SEK</td>
                                                </tr>
                                                <tr class="highlight">
                                                    <td>Grid Avoidance Benefit</td>
                                                    <td>0.4 kWh</td>
                                                    <td>1.91 SEK/kWh</td>
                                                    <td class="positive">+0.76 SEK</td>
                                                </tr>
                                                <tr class="cost">
                                                    <td>Battery Cost Basis</td>
                                                    <td>0.4 kWh</td>
                                                    <td>0.40 SEK/kWh</td>
                                                    <td class="negative">-0.16 SEK</td>
                                                </tr>
                                                <tr class="cost">
                                                    <td>Battery Wear Cost</td>
                                                    <td>0.4 kWh</td>
                                                    <td>0.05 SEK/kWh</td>
                                                    <td class="negative">-0.02 SEK</td>
                                                </tr>
                                                <tr class="total">
                                                    <td><strong>Net Immediate Value</strong></td>
                                                    <td>-</td>
                                                    <td>-</td>
                                                    <td class="negative"><strong>-1.53 SEK</strong></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="tab-content" id="future-0">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">⏰ Future Value</div>
                                            <div class="view-subtitle">How this decision creates value in upcoming hours</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(0, 'future', 'chart')">Chart</button>
                                            <button onclick="toggleView(0, 'future', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="futureChartContainer-0">
                                        <canvas id="futureChart-0" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="futureTable-0">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Hour</th>
                                                    <th>Value Added (SEK)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr><td>01:00</td><td class="positive">+0.02</td></tr>
                                                <tr><td>02:00</td><td class="positive">+0.02</td></tr>
                                                <tr><td>03:00</td><td class="positive">+0.02</td></tr>
                                                <tr><td>08:00</td><td class="negative">-0.23</td></tr>
                                                <tr><td>17:00</td><td class="positive">+0.12</td></tr>
                                                <tr><td>18:00</td><td class="positive">+0.15</td></tr>
                                                <tr class="highlight"><td><strong>19:00</strong></td><td class="positive"><strong>+2.18</strong></td></tr>
                                                <tr><td>20:00</td><td class="positive">+0.08</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Hour 01:00 Full -->
                    <tr class="hour-row actual" onclick="toggleHour(1)" data-hour="1">
                        <td>
                            <div>
                                01:00
                                <span class="badge badge-actual">Actual</span>
                            </div>
                        </td>
                        <td style="text-align: center;">
                            <div>1.9</div>
                            <span class="unit">kWh</span>
                        </td>
                        <td style="text-align: center;">
                            <div style="color: #d97706;">0.0</div>
                            <span class="unit">kWh</span>
                        </td>
                        <td style="text-align: center;">
                            <div>1.89</div>
                            <span class="unit">SEK/kWh</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+0.2 kWh</div>
                            <span class="unit">Charge</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+0.38</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+1.25</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+1.63</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <svg class="expand-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </td>
                    </tr>
                    
                    <!-- Hour 1 Details Full -->
                    <tr class="hour-details" data-hour="1" style="display: none;">
                        <td colspan="9" style="padding: 0; border: none;">
                            <div class="details-content" style="background: #f8fafc; border-left: 4px solid #22c55e; padding: 24px;">
                                <div class="tabs">
                                    <div class="tab active" onclick="showTab(1, 'landscape')">Battery Action</div>
                                    <div class="tab" onclick="showTab(1, 'economic')">Immediate Value</div>
                                    <div class="tab" onclick="showTab(1, 'future')">Future Value</div>
                                </div>
                                
                                <div class="tab-content active" id="landscape-1">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">📊 Battery Action Analysis</div>
                                            <div class="view-subtitle">Why was +0.2 kWh chosen over all other possible actions?</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(1, 'landscape', 'chart')">Chart</button>
                                            <button onclick="toggleView(1, 'landscape', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="landscapeChartContainer-1">
                                        <canvas id="landscapeChart-1" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="landscapeTable-1">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Action (kWh)</th>
                                                    <th>Total Reward (SEK)</th>
                                                    <th>Difference</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="highlight">
                                                    <td><strong>+0.2 (Chosen)</strong></td>
                                                    <td class="positive">+1.63</td>
                                                    <td>Optimal</td>
                                                </tr>
                                                <tr>
                                                    <td>0.0 (Do Nothing)</td>
                                                    <td>+0.80</td>
                                                    <td class="negative">-0.83</td>
                                                </tr>
                                                <tr>
                                                    <td>+0.5</td>
                                                    <td>+1.45</td>
                                                    <td class="negative">-0.18</td>
                                                </tr>
                                                <tr>
                                                    <td>-0.3</td>
                                                    <td>+0.80</td>
                                                    <td class="negative">-0.83</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="tab-content" id="economic-1">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">💰 Immediate Value Analysis</div>
                                            <div class="view-subtitle">What economic components create the immediate value?</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(1, 'economic', 'chart')">Chart</button>
                                            <button onclick="toggleView(1, 'economic', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="economicChartContainer-1">
                                        <canvas id="economicChart-1" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="economicTable-1">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Component</th>
                                                    <th>Energy</th>
                                                    <th>Rate</th>
                                                    <th>Value</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="highlight">
                                                    <td>Grid Purchase Avoidance</td>
                                                    <td>0.2 kWh</td>
                                                    <td>1.89 SEK/kWh</td>
                                                    <td class="positive">+0.38 SEK</td>
                                                </tr>
                                                <tr class="cost">
                                                    <td>Battery Cost Basis</td>
                                                    <td>0.2 kWh</td>
                                                    <td>0.40 SEK/kWh</td>
                                                    <td class="negative">-0.08 SEK</td>
                                                </tr>
                                                <tr class="cost">
                                                    <td>Battery Wear Cost</td>
                                                    <td>0.2 kWh</td>
                                                    <td>0.05 SEK/kWh</td>
                                                    <td class="negative">-0.01 SEK</td>
                                                </tr>
                                                <tr class="total">
                                                    <td><strong>Net Immediate Value</strong></td>
                                                    <td>-</td>
                                                    <td>-</td>
                                                    <td class="positive"><strong>+0.38 SEK</strong></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="tab-content" id="future-1">
                                    <div class="view-header">
                                        <div>
                                            <div class="view-title">⏰ Future Value</div>
                                            <div class="view-subtitle">How this decision creates value in upcoming hours</div>
                                        </div>
                                        <div class="tab-toggle">
                                            <button class="active" onclick="toggleView(1, 'future', 'chart')">Chart</button>
                                            <button onclick="toggleView(1, 'future', 'table')">Table</button>
                                        </div>
                                    </div>
                                    
                                    <div class="content-box" id="futureChartContainer-1">
                                        <canvas id="futureChart-1" class="chart-container"></canvas>
                                    </div>
                                    
                                    <div class="content-box hidden" id="futureTable-1">
                                        <table class="detail-table">
                                            <thead>
                                                <tr>
                                                    <th>Hour</th>
                                                    <th>Value Added (SEK)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr><td>02:00</td><td class="positive">+0.01</td></tr>
                                                <tr><td>03:00</td><td class="positive">+0.01</td></tr>
                                                <tr><td>08:00</td><td class="positive">+0.28</td></tr>
                                                <tr><td>09:00</td><td class="positive">+0.15</td></tr>
                                                <tr><td>18:00</td><td class="positive">+0.32</td></tr>
                                                <tr class="highlight"><td><strong>19:00</strong></td><td class="positive"><strong>+0.65</strong></td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Hour 02:00 Full -->
                    <tr class="hour-row predicted" onclick="toggleHour(2)" data-hour="2">
                        <td>
                            <div>
                                02:00
                                <span class="badge badge-predicted">Predicted</span>
                            </div>
                        </td>
                        <td style="text-align: center;">
                            <div>1.8</div>
                            <span class="unit">kWh</span>
                        </td>
                        <td style="text-align: center;">
                            <div style="color: #d97706;">0.0</div>
                            <span class="unit">kWh</span>
                        </td>
                        <td style="text-align: center;">
                            <div>1.95</div>
                            <span class="unit">SEK/kWh</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="neutral">0.0 kWh</div>
                            <span class="unit">Hold</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="neutral">0.00</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+2.15</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <div class="positive">+2.15</div>
                            <span class="unit">SEK</span>
                        </td>
                        <td style="text-align: center;">
                            <svg class="expand-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </td>
                    </tr>
                    
                    <!-- Hour 2 Details Full -->
                    <tr class="hour-details" data-hour="2" style="display: none;">
                        <td colspan="9" style="padding: 0; border: none;">
                            <div class="details-content" style="background: #f8fafc; border-left: 4px solid #e5e7eb; padding: 24px;">
                                <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 6px; padding: 12px;">
                                    <div style="font-weight: 600; color: #0369a1; margin-bottom: 4px;">🔮 Prediction Mode</div>
                                    <div style="color: #0369a1; font-size: 14px;">No action recommended - holding current battery level for optimal positioning during upcoming price fluctuations.</div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function toggleTableView(viewType) {
            const simpleTable = document.getElementById('simple-table');
            const fullTable = document.getElementById('full-table');
            const buttons = document.querySelectorAll('.toggle-btn');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (viewType === 'simple') {
                simpleTable.classList.remove('hidden');
                fullTable.classList.add('hidden');
                buttons[0].classList.add('active');
            } else {
                simpleTable.classList.add('hidden');
                fullTable.classList.remove('hidden');
                buttons[1].classList.add('active');
            }
        }
        
        function toggleHour(hourIndex) {
            const hourRows = document.querySelectorAll(`tr[data-hour="${hourIndex}"]`);
            
            hourRows.forEach(row => {
                if (row.classList.contains('hour-details')) {
                    // Toggle display of details row
                    if (row.style.display === 'none') {
                        row.style.display = 'table-row';
                        // Add expanded class to main hour rows
                        document.querySelectorAll(`tr.hour-row[data-hour="${hourIndex}"]`).forEach(r => r.classList.add('expanded'));
                    } else {
                        row.style.display = 'none';
                        // Remove expanded class from main hour rows
                        document.querySelectorAll(`tr.hour-row[data-hour="${hourIndex}"]`).forEach(r => r.classList.remove('expanded'));
                    }
                } else {
                    // Toggle expanded class for main hour row
                    row.classList.toggle('expanded');
                }
            });
        }
        
        function showTab(hourIndex, tabName) {
            const tabs = document.querySelectorAll(`.hour-details[data-hour="${hourIndex}"] .tab`);
            const contents = document.querySelectorAll(`.hour-details[data-hour="${hourIndex}"] .tab-content`);
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-${hourIndex}`).classList.add('active');
        }
        
        function toggleView(hourIndex, tabType, viewType) {
            const buttons = event.target.parentElement.querySelectorAll('button');
            const chartContainer = document.getElementById(`${tabType}ChartContainer-${hourIndex}`);
            const tableContainer = document.getElementById(`${tabType}Table-${hourIndex}`);
            
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (viewType === 'chart') {
                chartContainer.classList.remove('hidden');
                tableContainer.classList.add('hidden');
            } else {
                chartContainer.classList.add('hidden');
                tableContainer.classList.remove('hidden');
            }
        }
        
        // Initialize charts
        window.addEventListener('load', function() {
            initializeCharts();
        });
        
        function initializeCharts() {
            initializeChartsForHour(0);
            initializeChartsForHour(1);
        }
        
        function initializeChartsForHour(hour) {
            // Battery Action Chart
            const ctx = document.getElementById(`landscapeChart-${hour}`);
            if (ctx) {
                const actions = [];
                const rewards = [];
                
                for (let action = -15; action <= 15; action++) {
                    actions.push(action === 0 ? '0 (Hold)' : `${action > 0 ? '+' : ''}${action}`);
                    let reward;
                    if (hour === 0) {
                        const distance = Math.abs(action - (-0.4));
                        reward = 2.0 - (distance * distance * 0.15);
                        if (action === 0) reward = 1.16;
                    } else {
                        const distance = Math.abs(action - 0.2);
                        reward = 1.63 - (distance * distance * 0.12);
                        if (action === 0) reward = 0.8;
                    }
                    rewards.push(Math.max(reward, -5));
                }
                
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: actions,
                        datasets: [{
                            data: rewards,
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderColor: '#10b981',
                            borderWidth: 2,
                            pointBackgroundColor: rewards.map((reward) => {
                                const maxReward = Math.max(...rewards);
                                return Math.abs(reward - maxReward) < 0.01 ? '#f59e0b' : '#10b981';
                            }),
                            pointRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { title: { display: true, text: 'Expected Reward (SEK)' } },
                            x: { title: { display: true, text: 'Battery Action (kWh)' }, ticks: { maxTicksLimit: 15 } }
                        }
                    }
                });
            }
            
            // Economic Impact Chart
            const economicCtx = document.getElementById(`economicChart-${hour}`);
            if (economicCtx) {
                let waterfallData;
                if (hour === 0) {
                    waterfallData = [
                        { label: 'Start', value: 0, type: 'start' },
                        { label: 'Grid Purchase', value: -1.53, type: 'negative' },
                        { label: 'Grid Avoidance', value: 0.76, type: 'positive' },
                        { label: 'Battery Cost', value: -0.16, type: 'negative' },
                        { label: 'Battery Wear', value: -0.02, type: 'negative' },
                        { label: 'Net Result', value: -1.53, type: 'end' }
                    ];
                } else {
                    waterfallData = [
                        { label: 'Start', value: 0, type: 'start' },
                        { label: 'Grid Avoidance', value: 0.38, type: 'positive' },
                        { label: 'Battery Cost', value: -0.08, type: 'negative' },
                        { label: 'Battery Wear', value: -0.01, type: 'negative' },
                        { label: 'Net Result', value: 0.38, type: 'end' }
                    ];
                }
                
                new Chart(economicCtx, {
                    type: 'bar',
                    data: {
                        labels: waterfallData.map(d => d.label),
                        datasets: [{
                            data: waterfallData.map(d => d.value),
                            backgroundColor: waterfallData.map(d => {
                                if (d.type === 'start' || d.type === 'end') return '#6b7280';
                                return d.value > 0 ? '#22c55e' : '#ef4444';
                            })
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { title: { display: true, text: 'Value (SEK)' } },
                            x: { title: { display: true, text: 'Economic Components' } }
                        }
                    }
                });
            }
            
            // Future Value Chart
            const futureCtx = document.getElementById(`futureChart-${hour}`);
            if (futureCtx) {
                let futureData;
                if (hour === 0) {
                    futureData = [0.02, 0.02, 0.02, 0.03, 0.03, 0.03, 0.03, -0.23, -0.18, -0.15, -0.21, -0.19, -0.17, -0.16, -0.19, -0.20, 0.12, 0.15, 2.18, 0.08, 0.06, 0.04, 0.02];
                } else {
                    futureData = [0.01, 0.01, 0.02, 0.02, 0.02, 0.02, 0.28, 0.15, 0.12, -0.08, -0.06, -0.04, -0.03, -0.06, -0.07, 0.08, 0.32, 0.65, 0.05, 0.04, 0.03, 0.01];
                }
                
                new Chart(futureCtx, {
                    type: 'bar',
                    data: {
                        labels: Array.from({length: futureData.length}, (_, i) => `${String(i + (hour === 0 ? 1 : 2)).padStart(2, '0')}:00`),
                        datasets: [{
                            data: futureData,
                            backgroundColor: futureData.map(val => val > 0 ? '#84cc16' : '#f87171')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { title: { display: true, text: 'Future Hours' } },
                            y: { title: { display: true, text: 'Contribution (SEK)' } }
                        }
                    }
                });
            }
        }
    </script>
</body>
</html>